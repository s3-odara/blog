#!/bin/sh
set -eu

if [ "$#" -ne 1 ]; then
  echo "Usage: $0 path/to/file.html | -" >&2
  exit 2
fi

in=$1

if [ "$in" = "-" ]; then
  hxtoc -txf -l 2 -h 3
  exit 0
fi

if [ ! -f "$in" ]; then
  echo "Error: not found: $in" >&2
  exit 1
fi

dir=$(dirname -- "$in")
base=$(basename -- "$in")

tmp=$(mktemp "${dir}/.${base}.tmp.XXXXXX")
trap 'rm -f "$tmp"' EXIT

hxtoc -txf -l 2 -h 3 "$in" > "$tmp"

mv -f -- "$tmp" "$in"
echo "Updated TOC (h2-h3) in: $in" >&2

